# The "Code for Osnabrück" Homepage

This is the code for the "Code for Osnabrück" Homepage, but it can easily be
customized to serve as a homepage for other labs. Basically all Configuration
can be done in the `_config.yml` file. Simply replace all values with
whatever fits you lab. To get the meetup API key you have to go to  https://secure.meetup.com/meetup_api/key/.

See a live example at [codeforosnabrueck.org](http://www.codeforosnabrueck.org).
The code was originally forked from [Münster's page](https://github.com/codeformuenster/codeformuenster.github.io)

Another cool thing is that the fancy project list on the front page can automatically be fetched from the GitHub API by reading all the repositories of an organization.

We are generating a static HTMLpage that can be hosted on githubpages.


## How does it work?

* It would generate too many requests to the GitHub API if we would call the GitHub API live on every user request,  
* That is why there is a php script in this repository that can be called from the command line.
* It downloads all the repository meta data from GitHub and creates a summary json file that is then used by the static HTML front page.


# Step 1: Install jekyll locally to simulate github pages

## Install & run using Docker (experimental)

(These instructions are for Linux. On OSX/Windows, Docker has to be installed
differently.)

* Install [Docker Engine](https://docs.docker.com/install/).
* Install [Docker Compose](https://docs.docker.com/compose/install/).
* Then run: `docker-compose up`

The website is now available at [http://localhost:4000](http://localhost:4000). Posts and stylesheets will automatically be recompiled on change.

## Non-Docker Install

This site is build using jekyll.

    sudo gem install jekyll
    sudo gem install rdiscount
    sudo gem install bundler

Install dependencies:

    bundle install

# Step 2: Generate the Homepage

The project list will be created by fetching all sub-repositories from an organization at github.


## Configuration

Create the file "_config.ini":

    cp _config.ini.dist _config.ini

Enter your organization name and github access keys into the file.

## Github setup

* Every project of the organization needs the following things set up:
  * The fields "Description" and "Website" need to be
filled out in Github (The "Description" will used as project description and the "Website" URL will be visited and a screenshot will be taken)
  * If the "Description" contains the string..
    * "obsolet" or "obsolete", then the repository will be excluded from the list.
    * "(neu)" then a *work-in-progress* icon will be shown.
    * "idee" then a *this-is-just-an-idea* icon will be shown.
    * "(down)" then a *site-is-currently-down* icon will be shown.
* Project Issues
  * A progress bar for the project will be generated by counting the percentage of closed vs. open issues, so if you want to display a progress bar, then you need to have some open and closed tickets on the project.
* README.md
  * Project preview image: If you want to show a different one than the auto-generated screenshot as preview image, then put an image into the README.md. The first image found in the README.md will be used as preview image for the project. IF no image is found, then a screenshot will be generated by visiting the Project Website.
  * You can put a variable block with a status value into the README, like this:
  https://raw.githubusercontent.com/codeformuenster/open-data/master/README.md
  If a status value of "ok" or "done" is found, then the project will be displayed as finished.


## Update the project list and members on the homepage


First you need to install "shutter", so that it can automatically create the screenshots of your repositories:

    sudo apt-get install shutter

For using curl with PHP

    sudo apt-get install php-curl

Then you can generate the metadata json file that is used to render the repository list on the frontpage, by running:

    php update-data.php -1

Make sure that all the members of your organization set their visisbility to public so they can be feteched from the API without authentification.

# Step 3: Run it (for development)

Compiles the page after saving a code change:

    bundle exec jekyll serve

The website is now available at http://localhost:4000

Now you can make design changes, etc.


# Step 4: deploy it to github

* Commit the files  _json/*.json_
* Commit the file _index.html_
* Push it to the gh-pages branch.
* Done!



# Other useful things


## Update a single screenshot

Sometimes the screenshot generator generates ugly things, especially for javascript heavy pages.
Then use your favorite screenshot tool to take screenshots and then issue the following commands to resize the screenshot to appropriate size:

    convert screenshots-large/$repoName.png  -background white -resize 600x -crop 600x400+0+0 -strip -quality 80 $screenshot_file

    convert screenshots-large/wo-ist-markt.github.io.png  -background white -resize 600x -crop 600x400+0+0 -strip -quality 80 screenshots/wo-ist-markt.github.io.jpg

# Making adaptions

The project uses [`jQuery`](https://jquery.com/) and [`UIKit`](https://getuikit.com/) for most of the responsive design and intercation,
so if you want to change something, check out whether it can be achieved without adding further dependencies. Also try to keep site configurable and add lab specific
information only in the `_config.yml` and read it out in the template later.
Don't hard code things.

If you add new images to your page you should add the sources to the `/_data/img_sources.yml` file. The sources will then be automatically displayed in the footer of the page.
